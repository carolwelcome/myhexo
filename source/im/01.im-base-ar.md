---
title: 01.IM基础架构与特性
date: 2019-08-28 09:51:51
categories:  #分类
    - 即时消息
tags:   #标签
    - IM
    - 即时消息
description: 
    从零开始搭建自己的即时消息技术体系
---

### 使用者眼中的聊天系统

![使用者视角](/01.im-base-ar/user-view.png)
`用户账号`：聊天肯定是需要账号的，这个账号也可以用来作为用户的唯一标识 ，再附加一些头像、昵称等可供设置的属性。
`关系链`：这个就很好理解了，就是用户与用户之间的关系（加好友，添加关注等）
`联系人`：类似微信的好友列表，近期聊天对象列表，可选择一个进行聊天互动
`消息`：聊天互动就会产生消息，可以是文字、图片、其他文件等
`会话`：不就是所有的聊天的记录喽
### 开发者眼中的聊天系统
![开发者视角](/01.im-base-ar/dev-view.png)
`客户端`：用户用于收发消息的终端设备，内置的客户端程序和服务端进行网络通信，用来承载用户的互动消息请求和消息接收
`接入服务`：服务端门户，为客户端提供消息收发的出入口，发送消息先由客户端通过网络给到接入服务，然后由其递交给业务层进行处理。包含四块功能：连接保持、协议解析、Session维护和消息推送
`业务处理服务`：真正的消息业务逻辑处理层，比如消息的存储、未读数变化、更新最近联系人等都是业务处理的范畴，这一层专门用来处理复杂的业务逻辑
`存储服务`：账号信息、关系链、以及消息本身都需要进行持久化存储，跟消息相关的一些配置信息也需要在服务端进行存储
`外部接口服务`：为提升用户体验，APP未打开时（或后台运行）也能够接收到消息，就需要引入第三方外部接口服务，来通过操作系统自身的公共连接服务来进行操作系统级的消息推送，如推送到通知栏。
#### 为什么要把接入服务和业务处理服务拆分？
1.接入服务作为消息收发的出入口，必须是一个高可用的服务，保持足够的稳定性是一个必要条件
2.业务处理服务由于产品需求迭代，变更频繁，随时都有可能需要上线重启
3.从业务开发人员的角度看，接入服务和业务处理服务进行拆分有助于提升业务开发效率，降低业务开发门槛
### IM系统都有哪些特性
1.实时性
2.可靠性（不丢消息、消息不重复）
3.一致性（多账号一致性，多设备一致性）
4.安全性（数据传输安全、数据存储完全、消息内容安全）